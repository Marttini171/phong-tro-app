<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Quản lý phòng trọ</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h2 { margin-top: 30px; }
    .section { display: none; margin-top: 20px; }
    table, th, td { border: 1px solid #ccc; border-collapse: collapse; padding: 5px; }
    #output b { font-size: 20px; }
  </style>
</head>
<body>

<h1>Quản lý phòng trọ</h1>

<select onchange="showSection(this.value)">
  <option value="">-- Chọn chức năng --</option>
  <option value="themPhong">1. Thêm / Sửa / Xóa phòng</option>
  <option value="ghiDien">2. Ghi số điện</option>
  <option value="inPhieu">3. In phiếu điện</option>
</select>

<!-- 1. Thêm / Sửa / Xóa phòng -->
<div id="themPhong" class="section">
  <h2>Thêm phòng</h2>
  <input placeholder="Mã phòng" id="maPhong">
  <input placeholder="Tiền phòng" id="tienPhong">
  <input placeholder="Tiền xe" id="tienXe">
  <input placeholder="Tiền nước" id="tienNuoc">
  <input placeholder="Phí giặt" id="phiGiat">
  <input placeholder="Phí dịch vụ" id="phiDV">
  <input placeholder="Tủ lạnh" id="tuLanh">
  <input placeholder="Chi phí khác" id="chiPhiKhac">
  <input placeholder="Giá điện/kWh" id="giaDien">
  <button onclick="themPhong()">Thêm</button>

  <h2>Sửa phòng</h2>
  <select id="selectSua" onchange="dienThongTinSua()"></select><br>
  <input placeholder="Tiền phòng" id="s_tienPhong">
  <input placeholder="Tiền xe" id="s_tienXe">
  <input placeholder="Tiền nước" id="s_tienNuoc">
  <input placeholder="Phí giặt" id="s_phiGiat">
  <input placeholder="Phí dịch vụ" id="s_phiDV">
  <input placeholder="Tủ lạnh" id="s_tuLanh">
  <input placeholder="Chi phí khác" id="s_chiPhiKhac">
  <input placeholder="Giá điện/kWh" id="s_giaDien">
  <button onclick="suaPhong()">Cập nhật</button>

  <h2>Xóa phòng</h2>
  <select id="selectXoa"></select>
  <button onclick="xoaPhong()">Xóa</button>
</div>

<!-- 2. Ghi số điện -->
<div id="ghiDien" class="section">
  <h2>Ghi số điện</h2>
  <select id="chonPhongGhiDien" onchange="hienBangDien()"></select>
  <table id="bangDien"></table>
  <button onclick="luuSoDien()">Lưu số điện</button>
</div>

<!-- 3. In phiếu -->
<div id="inPhieu" class="section">
  <h2>In phiếu</h2>
  <select id="chonPhongIn"></select>
  <input placeholder="Tháng in (1-12)" id="thangIn" type="number">
  <button onclick="inPhieu()">In</button>
  <div id="output"></div>
</div>

<script>
let rooms = JSON.parse(localStorage.getItem("rooms")) || [];
let soDien = JSON.parse(localStorage.getItem("soDien")) || {};

function showSection(id) {
  document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
  if (id) document.getElementById(id).style.display = 'block';
  updateRoomDropdown();
}

function themPhong() {
  const room = {
    ma: document.getElementById("maPhong").value,
    tienPhong: +document.getElementById("tienPhong").value,
    tienXe: +document.getElementById("tienXe").value,
    tienNuoc: +document.getElementById("tienNuoc").value,
    phiGiat: +document.getElementById("phiGiat").value,
    phiDV: +document.getElementById("phiDV").value,
    tuLanh: +document.getElementById("tuLanh").value,
    chiPhiKhac: +document.getElementById("chiPhiKhac").value,
    giaDien: +document.getElementById("giaDien").value
  };
  rooms.push(room);
  localStorage.setItem("rooms", JSON.stringify(rooms));
  updateRoomDropdown();
  alert("Đã thêm phòng!");
}

function updateRoomDropdown() {
  const selects = ["selectSua", "selectXoa", "chonPhongGhiDien", "chonPhongIn"];
  selects.forEach(id => {
    const sel = document.getElementById(id);
    sel.innerHTML = "";
    rooms.forEach(r => {
      const opt = document.createElement("option");
      opt.value = opt.text = r.ma;
      sel.appendChild(opt);
    });
  });
}

function dienThongTinSua() {
  const ma = document.getElementById("selectSua").value;
  const r = rooms.find(r => r.ma === ma);
  if (!r) return;
  document.getElementById("s_tienPhong").value = r.tienPhong;
  document.getElementById("s_tienXe").value = r.tienXe;
  document.getElementById("s_tienNuoc").value = r.tienNuoc;
  document.getElementById("s_phiGiat").value = r.phiGiat;
  document.getElementById("s_phiDV").value = r.phiDV;
  document.getElementById("s_tuLanh").value = r.tuLanh;
  document.getElementById("s_chiPhiKhac").value = r.chiPhiKhac;
  document.getElementById("s_giaDien").value = r.giaDien;
}

function suaPhong() {
  const ma = document.getElementById("selectSua").value;
  const r = rooms.find(r => r.ma === ma);
  if (!r) return;
  r.tienPhong = +document.getElementById("s_tienPhong").value;
  r.tienXe = +document.getElementById("s_tienXe").value;
  r.tienNuoc = +document.getElementById("s_tienNuoc").value;
  r.phiGiat = +document.getElementById("s_phiGiat").value;
  r.phiDV = +document.getElementById("s_phiDV").value;
  r.tuLanh = +document.getElementById("s_tuLanh").value;
  r.chiPhiKhac = +document.getElementById("s_chiPhiKhac").value;
  r.giaDien = +document.getElementById("s_giaDien").value;
  localStorage.setItem("rooms", JSON.stringify(rooms));
  alert("Đã cập nhật!");
}

function xoaPhong() {
  const ma = document.getElementById("selectXoa").value;
  rooms = rooms.filter(r => r.ma !== ma);
  localStorage.setItem("rooms", JSON.stringify(rooms));
  alert("Đã xóa!");
  updateRoomDropdown();
}

function hienBangDien() {
  const ma = document.getElementById("chonPhongGhiDien").value;
  let table = "<tr><th>Tháng</th><th>Số điện</th></tr>";
  for (let i = 1; i <= 12; i++) {
    const val = (soDien[ma]?.[i] || "");
    table += `<tr><td>Tháng ${i}</td><td><input id="dien_${i}" value="${val}"></td></tr>`;
  }
  document.getElementById("bangDien").innerHTML = table;
}

function luuSoDien() {
  const ma = document.getElementById("chonPhongGhiDien").value;
  if (!soDien[ma]) soDien[ma] = {};
  for (let i = 1; i <= 12; i++) {
    const val = +document.getElementById(`dien_${i}`).value;
    soDien[ma][i] = val;
  }
  localStorage.setItem("soDien", JSON.stringify(soDien));
  alert("Đã lưu số điện!");
}

function inPhieu() {
  const ma = document.getElementById("chonPhongIn").value;
  const thang = +document.getElementById("thangIn").value;
  const r = rooms.find(r => r.ma === ma);
  const dienMoi = soDien[ma]?.[thang] || 0;
  const dienCu = soDien[ma]?.[thang - 1] || 0;
  const suDung = dienMoi - dienCu;
  const tienDien = suDung * (r?.giaDien || 0);
  const tong = r.tienPhong + r.tienXe + r.tienNuoc + r.phiGiat + r.phiDV + r.tuLanh + r.chiPhiKhac + tienDien;

  document.getElementById("output").innerHTML = `
    <h3>Phiếu tiền phòng trọ tháng ${thang}</h3>
    <p><b>Mã phòng: ${ma}</b></p>
    <p>Tiền phòng: ${r.tienPhong.toLocaleString()} VND</p>
    <p>Tiền xe: ${r.tienXe.toLocaleString()} VND</p>
    <p>Tiền nước: ${r.tienNuoc.toLocaleString()} VND</p>
    <p>Phí giặt: ${r.phiGiat.toLocaleString()} VND</p>
    <p>Phí dịch vụ: ${r.phiDV.toLocaleString()} VND</p>
    <p>Tủ lạnh: ${r.tuLanh.toLocaleString()} VND</p>
    <p>Chi phí khác: ${r.chiPhiKhac.toLocaleString()} VND</p>
    <p>Số điện cũ: ${dienCu}</p>
    <p>Số điện mới: ${dienMoi}</p>
    <p>Sử dụng: ${suDung} (× ${r.giaDien} VND/kWh)</p>
    <p>Tiền điện: ${tienDien.toLocaleString()} VND</p>
    <p><b style="font-size:24px">Tổng tiền thanh toán: ${tong.toLocaleString()} VND</b></p>
  `;
}
</script>

</body>
</html>
